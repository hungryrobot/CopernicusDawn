{% comment %}
Sales Rep Grid (Dawn 15+)
- All 12 rep cards visible, grouped by agency
- Larger square image
- Display swap: TITLE = GROUP NAME; Subtitle = SALES REP NAME
- Territory in long form (no abbreviations)
- Responsive grid: 4x3 (>=1200px), 3x4 (>=900px), 2x6 (<900px)
{% endcomment %}

<section class="rep-grid section-{{ section.id }}-padding">
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="title inline-richtext">{{ section.settings.heading }}</h2>
    {% endif %}
    {% if section.settings.subheading != blank %}
      <div class="rte mb-4">{{ section.settings.subheading }}</div>
    {% endif %}

    {%- comment -%} Unique agency list for grouping {%- endcomment -%}
    {% assign _groups = "" %}
    {% for block in section.blocks %}
      {% if block.type == 'rep' %}
        {% assign g = block.settings.group | strip %}
        {% if g != blank %}
          {% assign key = '|' | append: g | append: '|' %}
          {% unless _groups contains key %}
            {% assign _groups = _groups | append: key %}
          {% endunless %}
        {% endif %}
      {% endif %}
    {% endfor %}
    {% assign groups_list = _groups | remove_first: '|' | split: '|' %}

    {% for grp in groups_list %}
      <div class="rep-group">
        <h3 class="rep-group__title">{{ grp | upcase }}</h3>
        <div class="rep-group__grid">
          {% for block in section.blocks %}
            {% if block.type == 'rep' and block.settings.group == grp %}
              <article class="rep-card" {{ block.shopify_attributes }}>
                <div class="rep-card__inner">
                  <div class="rep-card__media">
                    {% if block.settings.photo != blank %}
                      {{ block.settings.photo | image_url: width: 700 | image_tag: loading: 'lazy', alt: block.settings.name | escape }}
                    {% elsif block.settings.photo_url != blank %}
                      <img src="{{ block.settings.photo_url | escape }}" alt="{{ block.settings.name | escape }}" loading="lazy">
                    {% else %}
                      <div class="rep-card__placeholder">
                        {% assign initials = '' %}
                        {% assign parts = block.settings.name | upcase | split: ' ' %}
                        {% if parts.size > 0 %}{% assign initials = parts[0] | slice: 0,1 %}{% endif %}
                        {% if parts.size > 1 %}{% assign initials = initials | append: parts[1] | slice: 0,1 %}{% endif %}
                        {{ initials | default: "â€“" }}
                      </div>
                    {% endif %}
                  </div>
                  <div class="rep-card__content">
                    <!-- SWAPPED DISPLAY: title shows GROUP, subtitle shows SALES REP NAME -->
                    <h4 class="rep-card__title">{{ grp | upcase }}</h4>
                    <div class="rep-card__subtitle text-subdued">{{ block.settings.name | upcase }}</div>

                    {% if block.settings.email != blank %}
                      <div class="rep-card__line"><a href="mailto:{{ block.settings.email | escape }}">{{ block.settings.email }}</a></div>
                    {% endif %}

                    {% if block.settings.territory != blank %}
                      <div class="rep-card__line"><strong>Territory:</strong> {{ block.settings.territory | upcase }}</div>
                    {% endif %}
                  </div>
                </div>
              </article>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}

    {% if groups_list.size == 0 %}
      <p class="text-subdued">No reps added yet. Use the Theme Editor to add Rep blocks.</p>
    {% endif %}
  </div>
</section>

<style>
  .rep-group { margin-bottom: 2rem; }
  .rep-group__title { margin: 0 0 .75rem; font-size: 1rem; letter-spacing: .06em; color: #111; }
  /* Grid: 4 x 3 desktop, 3 x 4 large tablets, 2 x 6 mobile */
  .rep-group__grid { display: grid; gap: 1.25rem; grid-template-columns: repeat(4, minmax(0, 1fr)); }
  @media (max-width: 1200px) { .rep-group__grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
  @media (max-width: 900px) { .rep-group__grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }

  .rep-card { background: #fff; border-radius: 12px; border: 1px solid rgba(0,0,0,.08); transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease; }
  .rep-card:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,0,0,.08); background: rgba(0,0,0,.02); }
  .rep-card__inner { display: grid; grid-template-columns: 112px 1fr; gap: 1rem; padding: 1rem; } /* larger image */
  .rep-card__media img { width: 112px; height: 112px; object-fit: cover; border-radius: 12px; display: block; }
  .rep-card__placeholder { width: 112px; height: 112px; border-radius: 12px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem; }
  .rep-card__title { margin: 0 0 .2rem; font-size: 1.125rem; line-height: 1.3; }
  .rep-card__subtitle { margin: .1rem 0 .35rem; }
  .rep-card__line { margin: .1rem 0; }
  .text-subdued { color: #6b7280; }
</style>

{% schema %}
{
  "name": "Sales rep grid (12)",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Our sales representatives" },
    { "type": "richtext", "id": "subheading", "label": "Intro (optional)" }
  ],
  "blocks": [
    {
      "type": "rep",
      "name": "Rep",
      "settings": [
        { "type": "image_picker", "id": "photo", "label": "Square photo (optional)" },
        { "type": "text", "id": "photo_url", "label": "Photo URL (optional, used if no image chosen)" },
        { "type": "text", "id": "group", "label": "Group / Agency", "default": "PACIFIC NORTHWEST" },
        { "type": "text", "id": "name", "label": "Sales rep name", "default": "JANE DOE" },
        { "type": "text", "id": "email", "label": "Email", "default": "rep@example.com" },
        { "type": "text", "id": "territory", "label": "Territory (long form, e.g., 'CALIFORNIA')", "default": "WA, OR, ID" }
      ]
    }
  ],
  "enabled_on": { "templates": ["*"] },
  "presets": [
    {
      "name": "Sales rep grid (12)",
      "settings": {
        "heading": "Our sales representatives",
        "subheading": "Copernicus Toys works with various independent toy and gift rep agencies across the US. They have loads of experience to help you fill your merchandising needs."
      },
      "blocks": {
        "rep-01": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "ANDREA FRIEDMAN", "email": "andreafriedman22@gmail.com", "territory": "CONNECTICUT", "photo_url": "" } },
        "rep-02": { "type": "rep", "settings": { "group": "INDEPENDENT / NOTHING BUT THE BEST", "name": "PAUL FRANZ", "email": "nothingbutthebest@comcast.net", "territory": "VERMONT", "photo_url": "" } },
        "rep-03": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "LISA GRIER", "email": "lgriersales@gmail.com", "territory": "DELAWARE", "photo_url": "" } },
        "rep-04": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "BRUCE KLICKSTEIN", "email": "emoments2@verizon.net", "territory": "NORTHERN MASSACHUSETTS, NEW HAMPSHIRE, MAINE, CAPE COD", "photo_url": "" } },
        "rep-05": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "SCOTT KENERLY", "email": "sksales.rf1@gmail.com", "territory": "NORTH CAROLINA (WESTERN), SELECT SOUTH CAROLINA, TENNESSEE, GEORGIA", "photo_url": "" } },
        "rep-06": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "KAREN STAHL", "email": "kstahl9837@aol.com", "territory": "UPSTATE NEW YORK", "photo_url": "" } },
        "rep-07": { "type": "rep", "settings": { "group": "INDEPENDENT", "name": "MARC STEINSLOFER", "email": "repintoys@aol.com", "territory": "PENNSYLVANIA, CONNECTICUT, NEW JERSEY", "photo_url": "" } },
        "rep-08": { "type": "rep", "settings": { "group": "KINFETTI SALES DIVISION / ENCHANTED", "name": "JOHN GRAVES", "email": "john@kinfetti.com", "territory": "IDAHO, MONTANA, WYOMING", "photo_url": "" } },
        "rep-09": { "type": "rep", "settings": { "group": "KINFETTI SALES DIVISION / ENCHANTED", "name": "MARY MORRISON", "email": "mary@enchantedmoments.com", "territory": "OREGON", "photo_url": "" } },
        "rep-10": { "type": "rep", "settings": { "group": "KETZ", "name": "LU KETZ", "email": "lu@ketzassociates.com", "territory": "IOWA, MINNESOTA, NEBRASKA, NORTH DAKOTA, SOUTH DAKOTA", "photo_url": "" } },
        "rep-11": { "type": "rep", "settings": { "group": "RBIZ", "name": "JERRY PINSKY", "email": "rbiz.south@gte.net", "territory": "LOS ANGELES, PHOENIX", "photo_url": "" } },
        "rep-12": { "type": "rep", "settings": { "group": "RBIZ", "name": "SHARLA LLOYD", "email": "lloydshar@yahoo.com", "territory": "NORTHERN / CENTRAL CALIFORNIA", "photo_url": "" } }
      },
      "block_order": [
        "rep-01","rep-02","rep-03","rep-04","rep-05","rep-06","rep-07","rep-08","rep-09","rep-10","rep-11","rep-12"
      ]
    }
  ]
}
{% endschema %}
